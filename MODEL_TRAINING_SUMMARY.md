# 模型训练总结

## 训练环境
- **scikit-learn 版本**: 1.4.2
- **训练时间**: 2026-02-19 23:46:54
- **Python 版本**: 3.11

## 数据集统计

### 原始数据
- 游戏数量: 8 局
- 样本数量: 16 个
- 问题: 数据量太少，模型可能过拟合

### 生成数据
- 游戏数量: 200 局
- 总样本数: 2400 个
- 狼人样本: 800 个 (33.3%)
- 好人样本: 1600 个 (66.7%)
- 每局样本数: 12 个

### 数据特征 (18维)
1. trust_score - 信任分数
2. vote_accuracy - 投票准确率
3. contradiction_count - 矛盾次数
4. injection_attempts - 注入攻击尝试
5. false_quotation_count - 虚假引用次数
6. avg_speech_length - 平均发言长度
7. voting_speed_avg - 平均投票速度
8. mentions_others_count - 提及他人次数
9. mentioned_by_others_count - 被他人提及次数
10. aggressive_score - 攻击性分数
11. defensive_score - 防御性分数
12. emotion_keyword_count - 情感关键词数量
13. logic_keyword_count - 逻辑关键词数量
14. night_survival_rate - 夜间存活率
15. alliance_strength - 联盟强度
16. isolation_score - 孤立分数
17. speech_consistency_score - 发言一致性分数
18. avg_response_time - 平均响应时间

## 训练的模型

### 1. Random Forest (随机森林)
- 树的数量: 100
- 最大深度: 10
- 交叉验证分数: 1.0000
- 训练集准确率: 100%

### 2. Gradient Boosting (梯度提升)
- 树的数量: 100
- 最大深度: 5
- 学习率: 0.1
- 交叉验证分数: 0.9996
- 训练集准确率: 100%

### 3. Decision Tree (决策树)
- 最大深度: 8
- 交叉验证分数: 0.9996
- 训练集准确率: 100%

## 模型性能

### 分类报告
```
              precision    recall  f1-score   support

        Good       1.00      1.00      1.00      1600
        Wolf       1.00      1.00      1.00       800

    accuracy                           1.00      2400
   macro avg       1.00      1.00      1.00      2400
weighted avg       1.00      1.00      1.00      2400
```

### 混淆矩阵
```
[[1600    0]
 [   0  800]]
```

## 测试结果

### 典型狼人特征
- 所有模型预测: Wolf (100% 置信度)
- 特征: 低信任分数、高矛盾、高攻击性、低逻辑性

### 典型好人特征
- 所有模型预测: Good (100% 置信度)
- 特征: 高信任分数、低矛盾、高逻辑性、低攻击性

### 高水平狼人（伪装好）
- 所有模型预测: Wolf (100% 置信度)
- 特征: 中高信任分数、较少破绽、但仍有细微特征差异

## 模型文件

### 文件位置
- 模型文件: `ml_models/ensemble.pkl` (153 KB)
- 元数据: `ml_models/model_metadata.json`

### 版本兼容性
- 训练版本: scikit-learn 1.4.2
- Docker 环境: scikit-learn 1.4.2
- 确保版本一致以避免加载错误

## 数据生成策略

### 技能等级分布
- **低水平玩家**: 破绽明显，容易识别
- **中等水平玩家**: 有一定伪装能力
- **高水平玩家**: 伪装能力强，但仍有细微差异

### 狼人特征模式
- 信任分数偏低 (20-75)
- 投票准确率低 (0.2-0.6)
- 矛盾次数多 (1-8)
- 可能有注入攻击 (0-4)
- 攻击性和防御性高 (0.4-1.0)
- 情感关键词多，逻辑关键词少
- 夜间存活率高 (0.7-1.0)

### 好人特征模式
- 信任分数偏高 (45-90)
- 投票准确率高 (0.4-0.9)
- 矛盾次数少 (0-3)
- 无注入攻击
- 攻击性和防御性低 (0.2-0.6)
- 逻辑关键词多，情感关键词少
- 夜间存活率低 (0.3-0.7)

## 使用说明

### 训练新模型
```bash
# 生成训练数据
python generate_training_data.py --games 200

# 训练模型
python train_base_model.py
```

### 测试模型
```bash
python test_model.py
```

### 在应用中使用
模型会自动被 `ml_enhanced/ensemble_detector.py` 加载和使用。

## 注意事项

1. **版本一致性**: 确保训练和部署环境使用相同的 scikit-learn 版本
2. **数据质量**: 当前使用模拟数据，实际游戏数据会更好
3. **过拟合风险**: 训练集准确率 100% 可能存在过拟合，需要真实数据验证
4. **持续学习**: 建议收集真实游戏数据后重新训练

## 下一步计划

1. 收集真实游戏数据
2. 添加验证集和测试集
3. 调整模型参数以减少过拟合
4. 实现在线学习和模型更新
5. 添加特征重要性分析
