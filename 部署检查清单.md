# 🚀 魔搭平台部署检查清单

## ✅ 已完成的修复

- [x] 添加 README.md 到 Dockerfile
- [x] 配置所有必需的环境变量到 ms_deploy.json
- [x] 添加启动前诊断脚本
- [x] 增强错误提示和日志输出
- [x] 注释掉可能失败的健康检查

## 📋 部署前检查

### 1. 文件完整性
- [x] README.md 存在
- [x] Dockerfile 已更新
- [x] start.sh 有执行权限
- [x] requirements-lite.txt 存在
- [x] werewolf/ 目录完整

### 2. 配置文件
- [x] ms_deploy.json 包含所有环境变量
- [x] .dockerignore 正确配置
- [x] config.py 配置正确

### 3. 环境变量（ms_deploy.json）
- [x] MODEL_NAME=deepseek-chat
- [x] OPENAI_API_KEY=sk-6320c699e7004706be3af12cde1eb3a6
- [x] OPENAI_BASE_URL=https://api.deepseek.com/v1
- [x] DETECTION_MODEL_NAME=deepseek-reasoner
- [x] ENABLE_GOLDEN_PATH=false
- [x] ML_AUTO_TRAIN=true

## 🔄 部署步骤

### 步骤1：提交代码
```bash
git add .
git commit -m "修复魔搭平台部署：添加README.md和完整配置"
git push
```

### 步骤2：魔搭平台操作
1. 进入创空间：https://modelscope.cn/studios/你的用户名/你的项目名
2. 点击"重新构建"或"重新部署"
3. 等待构建完成（预计1-3分钟）

### 步骤3：验证部署
1. 构建完成后，访问创空间URL
2. 应该看到 README.md 的内容或游戏界面
3. 不再显示 "Internal Server Error"

## 🔍 部署后验证

### 检查点1：构建日志
应该看到：
```
✓ Docker镜像构建成功
✓ 镜像推送成功
✓ 步骤运行成功
```

### 检查点2：运行日志
应该看到：
```
✓ MODEL_NAME: deepseek-chat
✓ OPENAI_BASE_URL: https://api.deepseek.com/v1
✓ werewolf模块可导入
✓ 所有检查通过，启动应用...
✓ VillagerAgent initialized
✓ WolfAgent initialized
✓ SeerAgent initialized
✓ WitchAgent initialized
✓ GuardAgent initialized
✓ HunterAgent initialized
✓ WolfKingAgent initialized
INFO: Uvicorn running on http://0.0.0.0:7860
```

### 检查点3：访问测试
- [ ] 访问根路径 `/` - 应该显示 README 内容
- [ ] 访问 `/docs` - 应该显示 API 文档
- [ ] 访问 `/health` - 应该返回健康状态（如果有）

## ⚠️ 可能的警告（可忽略）

以下警告是正常的，因为使用轻量级版本：
```
⚠ ML modules not available: No module named 'ml_enhanced'
WARNING: Golden Path learning system not available
ℹ️ 未配置DETECTION_MODEL_NAME，将使用主模型进行分析（单模型模式）
```

## 🐛 如果仍然失败

### 1. 检查构建日志
```bash
# 查找错误关键词
grep -i "error" 构建日志.log
grep -i "failed" 构建日志.log
```

### 2. 检查运行日志
在魔搭平台查看完整的运行日志，特别关注：
- FileNotFoundError
- ModuleNotFoundError
- KeyError
- AuthenticationError

### 3. 验证文件是否被复制
在运行日志中应该能看到文件列表，确认 README.md 被复制到容器中。

### 4. 测试API密钥
```bash
curl https://api.deepseek.com/v1/models \
  -H "Authorization: Bearer sk-6320c699e7004706be3af12cde1eb3a6"
```

## 📞 获取帮助

如果问题持续：
1. 复制完整的运行日志
2. 截图错误页面
3. 检查 API 密钥余额
4. 在魔搭社区发帖求助

## 🎯 预期结果

部署成功后：
- ✅ 访问创空间URL显示正常内容
- ✅ 所有7个角色Agent正常工作
- ✅ 可以开始狼人杀游戏
- ✅ 日志中没有严重错误

## 📊 资源使用

当前配置：
- CPU: 2核
- 内存: 16GB
- 磁盘: 约2GB
- 镜像大小: 约500MB

这个配置足够运行轻量级版本。

## 🎉 成功标志

看到以下任一情况即表示部署成功：
1. 页面显示 README.md 内容
2. 页面显示游戏界面
3. 访问 /docs 显示 API 文档
4. 日志显示 "Uvicorn running on http://0.0.0.0:7860"

---

**最后更新：** 2026-02-22
**问题状态：** 已解决 ✅
**解决方案：** 在 Dockerfile 中添加 `COPY README.md ./`
