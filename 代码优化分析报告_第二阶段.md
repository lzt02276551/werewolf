# 代码优化分析报告 - 第二阶段

**分析时间**: 1771669154.0
**检查文件数**: 99

## 1. 未使用的导入

发现 77 个未使用的导入语句

### check_deploy_ready.py

- 第9行: `os` (未使用)

### quick_fix_dead_code.py

- 第17行: `os` (未使用)
- 第18行: `sys` (未使用)

### verify_cleanup.py

- 第13行: `os` (未使用)
- 第15行: `ast` (未使用)
- 第17行: `List` (未使用)
- 第17行: `Dict` (未使用)
- 第17行: `Set` (未使用)
- 第17行: `Tuple` (未使用)

### cleanup_and_fix_plan.py

- 第9行: `os` (未使用)

### advanced_cleanup.py

- 第13行: `os` (未使用)

### werewolf\ml_agent.py

- 第8行: `np` (未使用)

### werewolf\game_utils.py

- 第8行: `Optional` (未使用)

### werewolf\game_end_handler.py

- 第8行: `Optional` (未使用)

### werewolf\guard\trust_manager.py

- 第11行: `Tuple` (未使用)
- 第11行: `Optional` (未使用)
- 第13行: `InvalidPlayerError` (未使用)
- 第13行: `GuardMemoryError` (未使用)

### werewolf\guard\decision_makers.py

- 第5行: `Optional` (未使用)

### werewolf\guard\guard_agent.py

- 第28行: `Optional` (未使用)

### werewolf\guard\analyzers.py

- 第12行: `Optional` (未使用)
- 第12行: `List` (未使用)

### werewolf\hunter\hunter_agent.py

- 第31行: `Optional` (未使用)

### werewolf\hunter\analyzers.py

- 第18行: `re` (未使用)

### werewolf\hunter\detectors.py

- 第9行: `Dict` (未使用)
- 第9行: `Any` (未使用)

### werewolf\seer\detectors.py

- 第9行: `Dict` (未使用)
- 第9行: `Any` (未使用)

### werewolf\seer\analyzers.py

- 第11行: `List` (未使用)
- 第11行: `Tuple` (未使用)
- 第11行: `Optional` (未使用)

### werewolf\seer\decision_makers.py

- 第9行: `Optional` (未使用)
- 第13行: `re` (未使用)

### werewolf\seer\seer_agent.py

- 第37行: `Dict` (未使用)
- 第37行: `List` (未使用)
- 第37行: `Tuple` (未使用)
- 第37行: `Optional` (未使用)
- 第38行: `os` (未使用)

### werewolf\seer\utils.py

- 第8行: `Optional` (未使用)
- 第9行: `logger` (未使用)

### werewolf\villager\villager_agent.py

- 第39行: `List` (未使用)
- 第39行: `Tuple` (未使用)
- 第39行: `Optional` (未使用)
- 第39行: `Any` (未使用)
- 第55行: `sys` (未使用)
- 第56行: `os` (未使用)

### werewolf\villager\analyzers.py

- 第7行: `Tuple` (未使用)
- 第7行: `Optional` (未使用)

### werewolf\villager\decision_makers.py

- 第7行: `Optional` (未使用)

### werewolf\witch\base_components.py

- 第8行: `Optional` (未使用)

### werewolf\witch\witch_agent.py

- 第27行: `Dict` (未使用)
- 第27行: `List` (未使用)

### werewolf\wolf\config.py

- 第9行: `Dict` (未使用)
- 第9行: `Any` (未使用)

### werewolf\wolf\wolf_agent.py

- 第18行: `Dict` (未使用)
- 第18行: `List` (未使用)
- 第18行: `Optional` (未使用)
- 第18行: `Any` (未使用)

### werewolf\wolf_king\wolf_king_agent.py

- 第19行: `Dict` (未使用)
- 第19行: `Optional` (未使用)
- 第19行: `Any` (未使用)

### werewolf\core\config.py

- 第7行: `field` (未使用)
- 第8行: `Optional` (未使用)

### werewolf\core\game_state.py

- 第7行: `Set` (未使用)

### werewolf\core\base_components.py

- 第9行: `logging` (未使用)
- 第11行: `ComponentError` (未使用)

### werewolf\core\base_agent.py

- 第8行: `Optional` (未使用)
- 第9行: `logging` (未使用)

### werewolf\core\agent_adapter.py

- 第9行: `logging` (未使用)
- 第47行: `BaseAgent` (未使用)

### werewolf\core\llm_detectors.py

- 第8行: `Optional` (未使用)

### werewolf\core\base_wolf_agent.py

- 第17行: `Dict` (未使用)
- 第20行: `json` (未使用)

### tests\test_p0_p1_fixes.py

- 第12行: `MagicMock` (未使用)
- 第12行: `patch` (未使用)

### ml_enhanced\ensemble_detector.py

- 第11行: `Tuple` (未使用)

### ml_enhanced\anomaly_detector.py

- 第10行: `Optional` (未使用)

## 2. 重复方法

发现 70 组重复方法

### `__new__(cls)`

出现在:
- werewolf\common\utils.py
- config.py

**建议**: 考虑提取到共享基类或工具模块

### `__init__(self)`

出现在:
- advanced_cleanup.py
- werewolf\core\decision_engine.py
- cleanup_and_fix_plan.py
- config.py
- werewolf\core\agent_adapter.py

**建议**: 考虑提取到共享基类或工具模块

### `to_dict(self)`

出现在:
- werewolf\core\config.py
- werewolf\wolf_king\config.py
- config.py
- werewolf\core\game_state.py
- werewolf\hunter\config.py
- werewolf\core\base_wolf_config.py

**建议**: 考虑提取到共享基类或工具模块

### `__repr__(self)`

出现在:
- werewolf\optimization\algorithms\bayesian_inference.py
- config.py

**建议**: 考虑提取到共享基类或工具模块

### `main()`

出现在:
- verify_cleanup.py
- run_tests.py
- check_deploy_ready.py
- test_fixes.py
- test_ml_enhanced.py
- test_guard_analyzers.py
- quick_fix_dead_code.py
- prepare_deploy.py
- verify_deploy.py

**建议**: 考虑提取到共享基类或工具模块

### `run(self)`

出现在:
- cleanup_and_fix_plan.py
- quick_fix_dead_code.py
- advanced_cleanup.py

**建议**: 考虑提取到共享基类或工具模块

### `generate_report(self)`

出现在:
- cleanup_and_fix_plan.py
- advanced_cleanup.py

**建议**: 考虑提取到共享基类或工具模块

### `predict_wolf_probability(self, player_data)`

出现在:
- ml_enhanced\ensemble_detector.py
- werewolf\ml_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `decorator(func)`

出现在:
- werewolf\villager\decision_makers.py
- werewolf\hunter\analyzers.py
- werewolf\villager\detectors.py
- werewolf\guard\trust_manager.py
- werewolf\hunter\decision_makers.py
- werewolf\villager\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `__init__(self, memory)`

出现在:
- werewolf\core\base_components.py
- werewolf\seer\memory_dao.py
- werewolf\guard\trust_manager.py
- werewolf\witch\base_components.py
- werewolf\hunter\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `initialize_players(self, players)`

出现在:
- werewolf\core\base_components.py
- werewolf\guard\trust_manager.py

**建议**: 考虑提取到共享基类或工具模块

### `get_score(self, player)`

出现在:
- werewolf\core\base_components.py
- werewolf\guard\trust_manager.py

**建议**: 考虑提取到共享基类或工具模块

### `wrapper()`

出现在:
- werewolf\villager\decision_makers.py
- werewolf\hunter\analyzers.py
- werewolf\villager\detectors.py
- werewolf\guard\trust_manager.py
- werewolf\hunter\decision_makers.py
- werewolf\villager\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `__init__(self, config)`

出现在:
- werewolf\core\base_components.py
- werewolf\villager\decision_makers.py
- werewolf\seer\decision_makers.py
- werewolf\guard\analyzers.py
- werewolf\optimization\algorithms\bayesian_inference.py
- werewolf\seer\utils.py
- werewolf\seer\analyzers.py
- werewolf\villager\analyzers.py
- werewolf\guard\decision_makers.py

**建议**: 考虑提取到共享基类或工具模块

### `decide(self, candidates, context)`

出现在:
- werewolf\villager\decision_makers.py
- werewolf\guard\decision_makers.py
- werewolf\seer\decision_makers.py

**建议**: 考虑提取到共享基类或工具模块

### `validate(self)`

出现在:
- werewolf\core\config.py
- werewolf\seer\config.py
- werewolf\villager\config.py
- werewolf\wolf_king\config.py
- werewolf\core\base_good_config.py
- werewolf\guard\config.py
- werewolf\core\game_state.py
- werewolf\hunter\config.py
- werewolf\core\base_wolf_config.py
- werewolf\witch\config.py

**建议**: 考虑提取到共享基类或工具模块

### `__init__(self, model_name)`

出现在:
- werewolf\seer\seer_agent.py
- werewolf\villager\villager_agent.py
- werewolf\hunter\hunter_agent.py
- werewolf\guard\guard_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `_init_memory_variables(self)`

出现在:
- werewolf\seer\seer_agent.py
- werewolf\witch\witch_agent.py
- werewolf\core\base_wolf_agent.py
- werewolf\wolf_king\wolf_king_agent.py
- werewolf\hunter\hunter_agent.py
- werewolf\core\base_good_agent.py
- werewolf\guard\guard_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `_init_specific_components(self)`

出现在:
- werewolf\seer\seer_agent.py
- werewolf\wolf\wolf_agent.py
- werewolf\witch\witch_agent.py
- werewolf\core\base_wolf_agent.py
- werewolf\wolf_king\wolf_king_agent.py
- werewolf\hunter\hunter_agent.py
- werewolf\villager\villager_agent.py
- werewolf\core\base_good_agent.py
- werewolf\guard\guard_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `perceive(self, req)`

出现在:
- werewolf\seer\seer_agent.py
- werewolf\wolf\wolf_agent.py
- werewolf\witch\witch_agent.py
- werewolf\wolf_king\wolf_king_agent.py
- werewolf\hunter\hunter_agent.py
- werewolf\villager\villager_agent.py
- werewolf\guard\guard_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `interact(self, req)`

出现在:
- werewolf\seer\seer_agent.py
- werewolf\wolf\wolf_agent.py
- werewolf\witch\witch_agent.py
- werewolf\wolf_king\wolf_king_agent.py
- werewolf\hunter\hunter_agent.py
- werewolf\villager\villager_agent.py
- werewolf\guard\guard_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `_interact_discuss(self, req)`

出现在:
- werewolf\seer\seer_agent.py
- werewolf\witch\witch_agent.py
- werewolf\hunter\hunter_agent.py
- werewolf\guard\guard_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `_generate_last_words(self)`

出现在:
- werewolf\seer\seer_agent.py
- werewolf\witch\witch_agent.py
- werewolf\hunter\hunter_agent.py
- werewolf\guard\guard_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `_interact_vote(self, req)`

出现在:
- werewolf\seer\seer_agent.py
- werewolf\witch\witch_agent.py
- werewolf\hunter\hunter_agent.py
- werewolf\guard\guard_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `_get_default_result(self)`

出现在:
- werewolf\core\base_components.py
- werewolf\villager\decision_makers.py
- werewolf\hunter\analyzers.py
- werewolf\villager\detectors.py
- werewolf\guard\analyzers.py
- werewolf\seer\analyzers.py
- werewolf\villager\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `_make_shoot_decision(self, candidates)`

出现在:
- werewolf\wolf_king\wolf_king_agent.py
- werewolf\hunter\hunter_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `safe_execute(default_return)`

出现在:
- werewolf\villager\decision_makers.py
- werewolf\hunter\analyzers.py
- werewolf\villager\detectors.py
- werewolf\hunter\decision_makers.py
- werewolf\villager\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `get(self, key, default)`

出现在:
- werewolf\core\base_components.py
- werewolf\seer\memory_dao.py
- werewolf\witch\base_components.py
- werewolf\common\memory_dao.py
- werewolf\hunter\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `set(self, key, value)`

出现在:
- werewolf\core\base_components.py
- werewolf\seer\memory_dao.py
- werewolf\witch\base_components.py
- werewolf\common\memory_dao.py
- werewolf\common\utils.py
- werewolf\hunter\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `get_my_name(self)`

出现在:
- werewolf\common\memory_dao.py
- werewolf\seer\memory_dao.py
- werewolf\hunter\analyzers.py
- werewolf\witch\base_components.py

**建议**: 考虑提取到共享基类或工具模块

### `get_trust_scores(self)`

出现在:
- werewolf\seer\memory_dao.py
- werewolf\hunter\analyzers.py
- werewolf\witch\base_components.py

**建议**: 考虑提取到共享基类或工具模块

### `set_trust_scores(self, scores)`

出现在:
- werewolf\seer\memory_dao.py
- werewolf\hunter\analyzers.py
- werewolf\witch\base_components.py

**建议**: 考虑提取到共享基类或工具模块

### `get_trust_history(self)`

出现在:
- werewolf\seer\memory_dao.py
- werewolf\hunter\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `set_trust_history(self, history)`

出现在:
- werewolf\seer\memory_dao.py
- werewolf\hunter\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `get_voting_history(self)`

出现在:
- werewolf\seer\memory_dao.py
- werewolf\hunter\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `get_voting_results(self)`

出现在:
- werewolf\common\memory_dao.py
- werewolf\seer\memory_dao.py
- werewolf\hunter\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `set_voting_results(self, results)`

出现在:
- werewolf\seer\memory_dao.py
- werewolf\hunter\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `get_speech_history(self)`

出现在:
- werewolf\seer\memory_dao.py
- werewolf\hunter\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `set_speech_history(self, history)`

出现在:
- werewolf\seer\memory_dao.py
- werewolf\hunter\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `get_injection_attempts(self)`

出现在:
- werewolf\seer\memory_dao.py
- werewolf\hunter\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `get_false_quotations(self)`

出现在:
- werewolf\seer\memory_dao.py
- werewolf\hunter\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `get_dead_players(self)`

出现在:
- werewolf\common\memory_dao.py
- werewolf\seer\memory_dao.py
- werewolf\hunter\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `get_sheriff(self)`

出现在:
- werewolf\common\memory_dao.py
- werewolf\seer\memory_dao.py
- werewolf\hunter\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `get_history(self)`

出现在:
- werewolf\common\memory_dao.py
- werewolf\seer\memory_dao.py
- werewolf\hunter\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `_do_analyze(self, player_name, context)`

出现在:
- werewolf\villager\analyzers.py
- werewolf\seer\analyzers.py

**建议**: 考虑提取到共享基类或工具模块

### `append_history(self, message)`

出现在:
- werewolf\seer\memory_dao.py
- werewolf\common\memory_dao.py

**建议**: 考虑提取到共享基类或工具模块

### `get_player_data(self)`

出现在:
- werewolf\seer\memory_dao.py
- werewolf\witch\base_components.py

**建议**: 考虑提取到共享基类或工具模块

### `set_player_data(self, data)`

出现在:
- werewolf\seer\memory_dao.py
- werewolf\witch\base_components.py

**建议**: 考虑提取到共享基类或工具模块

### `get_game_state(self)`

出现在:
- werewolf\seer\memory_dao.py
- werewolf\common\memory_dao.py

**建议**: 考虑提取到共享基类或工具模块

### `_infer_player_role(self, player_name, result_message, context)`

出现在:
- werewolf\villager\villager_agent.py
- werewolf\core\base_good_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `get_seer_checks(self)`

出现在:
- werewolf\common\memory_dao.py
- werewolf\witch\base_components.py

**建议**: 考虑提取到共享基类或工具模块

### `get_current_day(self)`

出现在:
- werewolf\common\memory_dao.py
- werewolf\witch\base_components.py

**建议**: 考虑提取到共享基类或工具模块

### `decide(self)`

出现在:
- werewolf\witch\decision_engine.py
- werewolf\core\base_components.py

**建议**: 考虑提取到共享基类或工具模块

### `__init__(self, model_name, analysis_model_name)`

出现在:
- werewolf\witch\witch_agent.py
- werewolf\wolf_king\wolf_king_agent.py
- werewolf\wolf\wolf_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `_handle_error(self, error, context)`

出现在:
- werewolf\core\base_agent.py
- werewolf\core\base_components.py

**建议**: 考虑提取到共享基类或工具模块

### `detect(self)`

出现在:
- werewolf\core\base_components.py
- werewolf\core\base_good_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `analyze(self)`

出现在:
- werewolf\core\base_components.py
- werewolf\core\base_good_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `_initialize_components(self)`

出现在:
- werewolf\core\base_agent.py
- werewolf\core\agent_adapter.py

**建议**: 考虑提取到共享基类或工具模块

### `_validate_game_state(self, game_state)`

出现在:
- werewolf\core\base_agent.py
- werewolf\core\agent_adapter.py

**建议**: 考虑提取到共享基类或工具模块

### `_build_context(self)`

出现在:
- werewolf\core\base_good_agent.py
- werewolf\core\agent_adapter.py

**建议**: 考虑提取到共享基类或工具模块

### `__init__(self, role, model_name)`

出现在:
- werewolf\core\base_good_agent.py
- werewolf\core\agent_adapter.py

**建议**: 考虑提取到共享基类或工具模块

### `_init_ml_enhancement(self)`

出现在:
- werewolf\core\base_wolf_agent.py
- werewolf\core\base_good_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `_init_shared_components(self)`

出现在:
- werewolf\core\base_wolf_agent.py
- werewolf\core\base_good_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `_process_player_message(self, message, player_name)`

出现在:
- werewolf\core\base_wolf_agent.py
- werewolf\core\base_good_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `_make_vote_decision(self, candidates)`

出现在:
- werewolf\core\base_wolf_agent.py
- werewolf\core\base_good_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `_truncate_output(self, text, max_length)`

出现在:
- werewolf\core\base_wolf_agent.py
- werewolf\core\base_good_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `_validate_player_name(self, output, valid_choices)`

出现在:
- werewolf\core\base_wolf_agent.py
- werewolf\core\base_good_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `_llm_analyze(self, prompt, temperature)`

出现在:
- werewolf\core\base_wolf_agent.py
- werewolf\core\base_good_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `_llm_generate(self, prompt, temperature)`

出现在:
- werewolf\core\base_wolf_agent.py
- werewolf\core\base_good_agent.py

**建议**: 考虑提取到共享基类或工具模块

### `_extract_features(self, player_data)`

出现在:
- ml_enhanced\ensemble_detector.py
- ml_enhanced\anomaly_detector.py

**建议**: 考虑提取到共享基类或工具模块

## 3. 复杂函数 (建议重构)

### config.py

- `__init__`: 152 行 (第104行)

**建议**: 将长函数拆分为多个小函数

### run_tests.py

- `run_all_tests`: 56 行 (第18行)

**建议**: 将长函数拆分为多个小函数

### prepare_deploy.py

- `copy_essential_files`: 60 行 (第34行)
- `create_deployment_readme`: 97 行 (第97行)

**建议**: 将长函数拆分为多个小函数

### check_deploy_ready.py

- `check_essential_files`: 59 行 (第32行)

**建议**: 将长函数拆分为多个小函数

### test_ml_enhanced.py

- `test_training`: 69 行 (第70行)
- `test_edge_cases`: 53 行 (第179行)
- `test_model_persistence`: 64 行 (第234行)

**建议**: 将长函数拆分为多个小函数

### quick_fix_dead_code.py

- `fix_seer_identity_reveal`: 56 行 (第120行)

**建议**: 将长函数拆分为多个小函数

### test_guard_analyzers.py

- `test_integration`: 64 行 (第140行)

**建议**: 将长函数拆分为多个小函数

### cleanup_and_fix_plan.py

- `analyze_prompt_code_consistency`: 63 行 (第128行)

**建议**: 将长函数拆分为多个小函数

### advanced_cleanup.py

- `run_analysis`: 73 行 (第132行)
- `generate_report`: 88 行 (第207行)

**建议**: 将长函数拆分为多个小函数

### werewolf\ml_agent.py

- `predict_wolf_probability`: 146 行 (第69行)

**建议**: 将长函数拆分为多个小函数

### werewolf\game_utils.py

- `trigger_game_end`: 60 行 (第39行)
- `handle_game_start`: 58 行 (第179行)
- `build_player_data_for_ml`: 161 行 (第308行)

**建议**: 将长函数拆分为多个小函数

### werewolf\game_end_handler.py

- `on_game_end`: 74 行 (第40行)

**建议**: 将长函数拆分为多个小函数

### werewolf\incremental_learning.py

- `on_game_end`: 82 行 (第78行)
- `_retrain_models`: 80 行 (第162行)

**建议**: 将长函数拆分为多个小函数

### werewolf\guard\trust_manager.py

- `update_score`: 77 行 (第99行)

**建议**: 将长函数拆分为多个小函数

### werewolf\guard\decision_makers.py

- `decide`: 88 行 (第42行)

**建议**: 将长函数拆分为多个小函数

### werewolf\guard\guard_agent.py

- `_interact_discuss`: 83 行 (第250行)
- `_generate_last_words`: 54 行 (第364行)

**建议**: 将长函数拆分为多个小函数

### werewolf\hunter\analyzers.py

- `_do_analyze`: 81 行 (第156行)
- `calculate`: 51 行 (第280行)

**建议**: 将长函数拆分为多个小函数

### werewolf\hunter\decision_makers.py

- `decide`: 89 行 (第56行)

**建议**: 将长函数拆分为多个小函数

### werewolf\hunter\config.py

- `validate`: 54 行 (第57行)

**建议**: 将长函数拆分为多个小函数

### werewolf\seer\analyzers.py

- `_do_analyze`: 99 行 (第31行)

**建议**: 将长函数拆分为多个小函数

### werewolf\villager\villager_agent.py

- `perceive`: 308 行 (第245行)
- `interact`: 312 行 (第557行)

**建议**: 将长函数拆分为多个小函数

### werewolf\villager\detectors.py

- `_detect_with_llm`: 102 行 (第142行)
- `_detect_with_llm`: 121 行 (第327行)
- `_detect_with_rules`: 77 行 (第454行)
- `_parse_with_llm`: 97 行 (第589行)
- `_parse_with_rules`: 76 行 (第692行)
- `_evaluate_with_llm`: 82 行 (第819行)

**建议**: 将长函数拆分为多个小函数

### werewolf\villager\analyzers.py

- `_update_trust_score`: 83 行 (第73行)
- `_calculate_trust_score`: 264 行 (第188行)
- `_analyze_voting_pattern`: 106 行 (第479行)

**建议**: 将长函数拆分为多个小函数

### werewolf\villager\decision_makers.py

- `_calculate_vote_priority`: 81 行 (第90行)
- `decide`: 84 行 (第483行)

**建议**: 将长函数拆分为多个小函数

### werewolf\wolf\wolf_agent.py

- `perceive`: 120 行 (第82行)
- `interact`: 239 行 (第204行)

**建议**: 将长函数拆分为多个小函数

### werewolf\core\base_good_config.py

- `validate`: 96 行 (第80行)

**建议**: 将长函数拆分为多个小函数

### werewolf\core\base_good_agent.py

- `_init_shared_components`: 58 行 (第207行)
- `_init_placeholder_detectors`: 85 行 (第313行)
- `_process_player_message`: 147 行 (第416行)
- `_make_vote_decision`: 51 行 (第565行)
- `_handle_game_end`: 56 行 (第830行)
- `_infer_player_role`: 71 行 (第936行)

**建议**: 将长函数拆分为多个小函数

### werewolf\core\base_wolf_config.py

- `validate`: 69 行 (第105行)

**建议**: 将长函数拆分为多个小函数

### werewolf\core\base_wolf_agent.py

- `_process_player_message`: 54 行 (第257行)
- `_make_kill_decision`: 55 行 (第442行)
- `_make_vote_decision`: 51 行 (第519行)

**建议**: 将长函数拆分为多个小函数

### werewolf\core\decision_engine.py

- `decide_vote`: 61 行 (第33行)
- `_decision_tree_scoring`: 300 行 (第97行)
- `_calculate_confidence`: 57 行 (第543行)
- `_convert_evidence`: 99 行 (第658行)
- `infer_role`: 56 行 (第792行)
- `decide_seer_check`: 55 行 (第859行)

**建议**: 将长函数拆分为多个小函数

### werewolf\optimization\algorithms\trust_score.py

- `update_trust_score`: 65 行 (第58行)

**建议**: 将长函数拆分为多个小函数

### werewolf\optimization\algorithms\bayesian_inference.py

- `calculate_posterior`: 105 行 (第129行)

**建议**: 将长函数拆分为多个小函数

### ml_enhanced\ensemble_detector.py

- `__init__`: 57 行 (第44行)
- `_extract_features`: 88 行 (第103行)

**建议**: 将长函数拆分为多个小函数

### ml_enhanced\anomaly_detector.py

- `_extract_features`: 88 行 (第61行)

**建议**: 将长函数拆分为多个小函数

### ml_enhanced\bayesian_inference.py

- `analyze_player`: 92 行 (第39行)

**建议**: 将长函数拆分为多个小函数

### ml_enhanced\feature_extractor.py

- `extract_features`: 93 行 (第63行)

**建议**: 将长函数拆分为多个小函数

## 优化建议

### 优先级 P1 (高)

1. 清理 77 个未使用的导入语句
2. 重构 70 组重复方法

### 优先级 P2 (中)

1. 重构复杂函数，提高可读性
2. 添加单元测试覆盖
3. 完善代码注释
