# 狼人杀代理人代码与提示词一致性检查计划

## 执行目标
1. 检查每个代理人的代码实现是否与提示词要求的功能一致
2. 识别死代码、死方法和未使用的组件
3. 验证各代理人功能的完整性
4. 提供清理和修复建议

## 代理人列表与核心功能

### 1. 守卫 (Guard)
**提示词要求的核心功能:**
- 守护技能（每晚守护一名玩家，不能连续守护同一人）
- 首夜空守策略（防止奶穿）
- 守护目标选择（基于信任分数和角色估计）
- 守护历史管理
- 注入攻击检测和纠正
- 虚假引用检测
- 信任分数系统

**代码实现检查点:**
- ✓ 继承 BaseGoodAgent
- ✓ GuardDecisionMaker 守护决策器
- ✓ RoleEstimator 角色估计器
- ✓ WolfKillPredictor 狼人击杀预测器
- ✓ GuardPriorityCalculator 守护优先级计算器
- ✓ 守护历史记录
- ✓ 首夜空守逻辑

**潜在问题:**
- 需要验证 analyzers.py 中的所有分析器是否被实际调用
- 检查 trust_manager 的依赖设置是否完整

### 2. 猎人 (Hunter)
**提示词要求的核心功能:**
- 开枪技能（被淘汰时可开枪）
- 开枪目标选择（基于威胁等级和狼人概率）
- 身份隐藏策略（早期隐藏，后期暴露）
- 诱饵战术（假装其他神职吸引狼人）
- 注入攻击检测

**代码实现检查点:**
- ✓ 继承 BaseGoodAgent
- ✓ ShootDecisionMaker 开枪决策器
- ✓ ThreatLevelAnalyzer 威胁等级分析器
- ✓ WolfProbabilityCalculator 狼人概率计算器
- ✓ 开枪状态管理

**潜在问题:**
- 需要验证 game_state.py 是否被使用
- 检查 detectors.py 中的检测器是否有死代码

### 3. 预言家 (Seer)
**提示词要求的核心功能:**
- 验人技能（每晚查验一名玩家）
- 验人结果管理
- 验人优先级计算（注入攻击者、虚假引用者优先）
- 身份暴露策略（有狼查验立即暴露）
- 假预言家对抗
- 警长竞选策略

**代码实现检查点:**
- ✓ 继承 BaseGoodAgent
- ✓ CheckDecisionMaker 验人决策器
- ✓ CheckPriorityCalculator 验人优先级计算器
- ✓ CheckReasonGenerator 验人理由生成器
- ✓ 验人结果记录

**潜在问题:**
- 需要验证 ml_integration.py 是否被实际使用
- 检查 memory_dao.py 的所有方法是否都被调用

### 4. 平民 (Villager)
**提示词要求的核心功能:**
- 纯推理和投票（无特殊技能）
- 注入攻击检测（3种类型）
- 虚假引用检测
- 发言位置分析（早中晚位置策略）
- 游戏阶段分析
- 遗言生成

**代码实现检查点:**
- ✓ 继承 BaseGoodAgent
- ✓ BadgeTransferDecisionMaker 徽章转移决策器
- ✓ SpeechOrderDecisionMaker 发言顺序决策器
- ✓ LastWordsGenerator 遗言生成器
- ✓ SpeechPositionAnalyzer 发言位置分析器

**潜在问题:**
- villager_agent.py 文件被截断，需要完整读取
- 检查所有决策器是否都被实际调用

### 5. 女巫 (Witch)
**提示词要求的核心功能:**
- 解药使用决策（救人）
- 毒药使用决策（杀人）
- 药品状态管理
- 首夜策略（优先救人）
- 自救判断
- 注入攻击检测

**代码实现检查点:**
- ✓ 继承 BaseGoodAgent
- ✓ WitchDecisionEngine 决策引擎
- ✓ WitchMemoryDAO 内存访问对象
- ✓ 药品状态管理

**潜在问题:**
- 需要验证 decision_engine.py 的所有方法是否被调用
- 检查 analyzers.py 是否有未使用的分析器

### 6. 狼人 (Wolf)
**提示词要求的核心功能:**
- 夜晚击杀决策
- 狼人内部发言
- 伪装策略（假预言家、隐藏狼、冲锋狼）
- 队友智商评估
- 威胁等级分析
- 卖队友战术
- 注入攻击响应（分析意图）

**代码实现检查点:**
- ✓ 继承 BaseWolfAgent
- ✓ 击杀决策
- ✓ 投票决策
- ✓ 狼人内部交流

**潜在问题:**
- wolf/prompt.py 文件被截断，需要完整读取
- 需要验证 base_components.py 和 decision_engine.py 是否被使用

### 7. 狼王 (Wolf King)
**提示词要求的核心功能:**
- 继承狼人所有功能
- 开枪技能（被投票出局时）
- 开枪目标选择
- 领导狼队
- 射击威慑

**代码实现检查点:**
- ✓ 继承 BaseWolfAgent
- ✓ 开枪决策
- ✓ 开枪状态管理

**潜在问题:**
- wolf_king/prompt.py 文件被截断，需要完整读取
- 需要验证所有特有功能是否完整实现

## 检查方法

### 阶段1: 完整文件读取
1. 读取所有被截断的文件完整内容
2. 读取所有组件文件（analyzers, decision_makers, detectors等）

### 阶段2: 功能映射
1. 对比提示词中的功能要求
2. 检查代码中的实际实现
3. 标记缺失的功能

### 阶段3: 死代码识别
1. 检查未被调用的方法
2. 检查未被导入的模块
3. 检查未被使用的类

### 阶段4: 依赖关系验证
1. 验证组件之间的依赖关系
2. 检查初始化顺序
3. 验证数据流

### 阶段5: 生成报告
1. 创建详细的检查报告
2. 列出所有发现的问题
3. 提供修复建议

## 下一步行动
1. 读取所有被截断的文件
2. 读取所有组件文件
3. 执行详细检查
4. 生成完整报告
